<!DOCTYPE html>
<html :data-bs-theme="$store.controls.isLightTheme ? 'light' : 'dark'" x-data>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>blurt</title>
    <link rel="icon" href="blurt-icon.svg" sizes="any" type="image/svg+xml">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        [data-bs-theme="dark"] {
            --bs-body-bg: #000;
        }
        .cursor-pointer {
            cursor: pointer;
        }
        .alert {
            z-index: 1090; /* $zindex-toast */
        }
        nav {
            opacity: 50%;
            transition: opacity 1000ms ease-out;
        }
        nav:hover {
            opacity: 100%;
            transition: opacity 50ms ease-in;
        }
        .transition {
            transition-duration: 250ms;
        }
        @media (min-width: 576px) {
            .position-sm-relative {
                position: relative!important;
            }
        }
        .bg-opacity-10 {
            --bs-bg-opacity: 0.1;
        }
        .bg-opacity-20 {
            --bs-bg-opacity: 0.2;
        }
        .bg-opacity-30 {
            --bs-bg-opacity: 0.3;
        }
        .bg-opacity-40 {
            --bs-bg-opacity: 0.4;
        }
        .bg-opacity-60 {
            --bs-bg-opacity: 0.6;
        }
        .bg-opacity-70 {
            --bs-bg-opacity: 0.7;
        }
        .bg-opacity-80 {
            --bs-bg-opacity: 0.8;
        }
        .bg-opacity-90 {
            --bs-bg-opacity: 0.9;
        }
    </style>
</head>
<body class="container mt-1">
    <nav class="navbar navbar-expand-sm d-block" x-show.important="!$store.controls.isZenMode">
        <div class="container-fluid">
            <ul class="navbar-nav mx-auto align-items-center gap-1 gap-sm-3">
                <!-- QR code button -->
                <li class="nav-item start-0 position-absolute position-sm-relative">
                    <button
                        type="button"
                        @click="$store.controls.isQRCodeShown = true"
                        :class="$store.controls.getButtonClass()"
                        title="show QR code (q)"
                    >
                        <i class="bi-qr-code-scan"></i>
                    </button>
                </li>

                <!-- URL -->
                <li class="nav-item d-none d-lg-block">
                    <span
                        class="font-monospace text-secondary-emphasis"
                        style="overflow-wrap: anywhere;"
                        x-text="$store.controls.studentUrl"
                    ></span>
                </li>

                <!-- Response counts -->
                <li class="navbar-text text-secondary text-nowrap collapse navbar-collapse">
                    <span x-text="$store.responses.nonEmpty" aria-label="non-empty response count"></span>
                    /
                    <span x-text="$store.responses.total" aria-label="total response count"></span>
                </li>

                <!-- Mode controls -->
                <li class="nav-item">
                    <div class="btn-group" aria-label="response mode controls">
                        <button
                            type="button"
                            :class="$store.controls.getButtonClass($store.controls.mode === 'off')"
                            @click="$store.controls.setMode('off')"
                            title="set mode: off (o)"
                        >
                            <i class="bi-power me-lg-1"></i>
                            <span class="d-none d-lg-inline"><u>o</u>ff</span>
                        </button>
                        <button
                            type="button"
                            :class="$store.controls.getButtonClass($store.controls.mode === 'text')"
                            @click="$store.controls.setMode('text')"
                            title="set mode: text (t)"
                        >
                            <i class="bi-cursor-text me-lg-1"></i>
                            <span class="d-none d-lg-inline"><u>t</u>ext</span>
                        </button>
                        <button
                            type="button"
                            :class="$store.controls.getButtonClass($store.controls.mode === 'number')"
                            @click="$store.controls.setMode('number')"
                            title="set mode: number (n)"
                        >
                            <i class="bi-123 me-lg-1"></i>
                            <span class="d-none d-lg-inline"><u>n</u>umber</span>
                        </button>
                        <button
                            type="button"
                            :class="$store.controls.getButtonClass($store.controls.mode === 'yes-no-maybe')"
                            @click="$store.controls.setMode('yes-no-maybe')"
                            title="set mode: yes/no/maybe (y)"
                        >
                            <i class="bi-hand-thumbs-up me-lg-1"></i>
                            <span class="d-none d-lg-inline"><u>y</u>es/no</span>
                        </button>
                        <button
                            type="button"
                            :class="$store.controls.getButtonClass($store.controls.mode.startsWith('multi'))"
                            @click="$store.controls.setMode('multi-4')"
                            title="set mode: multiple choice 4 (m)"
                        >
                            <i class="bi-ui-radios-grid me-lg-1"></i>
                            <span class="d-none d-lg-inline"><u>m</u>ulti</span>
                        </button>
                    </div>

                    <!-- Menu toggle -->
                    <button
                        type="button"
                        @click="$store.controls.isMenuShown = !$store.controls.isMenuShown"
                        :class="$store.controls.getButtonClass()"
                        title="show controls (esc)"
                    >
                        <i class="bi-list"></i>
                    </button>
                </li>
            </ul>
        </div>

        <!-- Display controls ("menu") -->
        <div class="container-fluid mt-2" x-show="$store.controls.isMenuShown">
            <ul class="navbar-nav mx-auto align-items-center gap-1 gap-sm-3">
                <li class="nav-item">
                    <div class="btn-group" aria-label="response display controls">
                        <button
                            type="button"
                            :class="$store.controls.getButtonClass()"
                            @click="$store.controls.isLightTheme = !$store.controls.isLightTheme"
                            :title="$store.controls.isLightTheme ? 'dark (d)' : 'light (l)'"
                        >
                            <span x-show="$store.controls.isLightTheme">
                                <i class="bi-moon me-lg-1"></i>
                                <span class="d-none d-lg-inline"><u>d</u>ark</span>
                            </span>
                            <span x-show="!$store.controls.isLightTheme">
                                <i class="bi-sun me-lg-1"></i>
                                <span class="d-none d-lg-inline"><u>l</u>ight</span>
                            </span>
                        </button>
                        <button
                            type="button"
                            :class="$store.controls.getButtonClass()"
                            @click="$store.controls.autoHide = !$store.controls.autoHide"
                            title="auto-hide (a)"
                        >
                            <span x-show="$store.controls.autoHide">
                                <i class="bi-shield-slash me-lg-1"></i>
                                <span class="d-none d-lg-inline">no <u>a</u>uto-hide</span>
                            </span>
                            <span x-show="!$store.controls.autoHide">
                                <i class="bi-shield me-lg-1"></i>
                                <span class="d-none d-lg-inline"><u>a</u>uto-hide</span>
                            </span>
                        </button>
                        <button
                            type="button"
                            :class="$store.controls.getButtonClass()"
                            @click="$store.controls.areResponsesShown = !$store.controls.areResponsesShown"
                            :title="$store.controls.areResponsesShown ? 'hide (h)' : 'show (s)'"
                        >
                            <span x-show="$store.controls.areResponsesShown">
                                <i class="bi-eye-slash me-lg-1"></i>
                                <span class="d-none d-lg-inline"><u>h</u>ide</span>
                            </span>
                            <span x-show="!$store.controls.areResponsesShown">
                                <i class="bi-eye me-lg-1"></i>
                                <span class="d-none d-lg-inline"><u>s</u>how</span>
                            </span>
                        </button>
                        <button
                            type="button"
                            :class="$store.controls.getButtonClass()"
                            @click="$store.controls.areCountsShown = !$store.controls.areCountsShown"
                            :title="$store.controls.areCountsShown ? 'no counts (/)' : 'counts (/)'"
                        >
                            <span>
                                <span x-show="$store.controls.areCountsShown">
                                    <i class="bi-slash-lg me-lg-1"></i>
                                    <span class="d-none d-lg-inline">no counts</span>
                                </span>
                                <span x-show="!$store.controls.areCountsShown">
                                    <i class="bi-percent me-lg-1"></i>
                                    <span class="d-none d-lg-inline">counts</span>
                                </span>
                            </span>
                        </button>
                        <button
                            type="button"
                            :class="$store.controls.getButtonClass()"
                            @click="$store.controls.pauseUpdates()"
                            x-show="!$store.controls.areUpdatesPaused"
                            title="pause (space)"
                        >
                            <i class="bi-pause me-lg-1"></i>
                            <span class="d-none d-lg-inline">pause</span>
                        </button>
                        <button
                            type="button"
                            :class="$store.controls.getButtonClass()"
                            @click="$store.controls.resumeUpdates()"
                            x-show="$store.controls.areUpdatesPaused"
                            title="resume (space)"
                        >
                            <i class="bi-play me-lg-1"></i>
                            <span class="d-none d-lg-inline">resume</span>
                        </button>
                        <button
                            type="button"
                            :class="$store.controls.getButtonClass()"
                            @click="$store.responses.clear()"
                            title="clear (c)"
                        >
                            <i class="bi-trash me-lg-1"></i>
                            <span class="d-none d-lg-inline"><u>c</u>lear</span>
                        </button>
                        <button
                            type="button"
                            :class="$store.controls.getButtonClass()"
                            @click="$store.responses.pick()"
                            title="pick (p)"
                        >
                            <i class="bi-lightbulb me-lg-1"></i>
                            <span class="d-none d-lg-inline"><u>p</u>ick</span>
                        </button>
                        <button
                            type="button"
                            :class="$store.controls.getButtonClass()"
                            @click="$store.responses.unpick()"
                            title="unpick (u)"
                        >
                            <i class="bi-lightbulb-off me-lg-1"></i>
                            <span class="d-none d-lg-inline"><u>u</u>npick</span>
                        </button>
                    </div>
                </li>
            </ul>
        </div>
    </nav>
    <div
        class="cursor-pointer text-center font-monospace position-fixed bottom-0 end-0 bg-body bg-opacity-75 w-100 h-100 pt-3 z-2"
        x-show="$store.controls.isQRCodeShown"
        @click="$store.controls.isQRCodeShown = false"
        aria-label="QR code (big)"
        title="click to close"
    >
        <p x-text="$store.controls.studentUrl" class="fs-1 px-3" style="overflow-wrap: anywhere;"></p>
        <canvas id="qrcodeBig"></canvas>
        <p x-text="`participants: ${$store.responses.total}`" class="mt-1 text-body-tertiary" aria-label="joined participants"></p>
    </div>
    <div
        class="mt-4 d-flex flex-wrap align-content-center justify-content-center"
        :class="$store.controls.mode === 'number' ? 'align-items-end' : 'align-items-center'"
        :style="$store.responses.containerStyle"
    >
        <template x-for="rc in $store.responses.counts" :key="rc.key">
            <div
                class="cursor-pointer user-select-none"
                :class="$store.responses.getBadgeClass(rc)"
                :style="$store.responses.getBadgeStyle(rc)"
                :data-count="rc.count"
                @click="$store.responses.pick(rc.response)"
                title="Click to pick a participant with this response"
            >
                <div x-text="$store.controls.areResponsesShown ? rc.response : 'â‹¯'"></div>
                <div
                    class="opacity-25 mt-1"
                    style="font-size: initial;"
                    x-show="$store.controls.areCountsShown"
                >
                    <span x-text="rc.count"></span>/<span x-text="$store.responses.nonEmpty"></span>
                    &middot;
                    <span x-text="Math.round(100 * rc.count / $store.responses.nonEmpty)"></span>%
                </div>
            </div>
        </template>
    </div>
    <script type="module" src="dist/teacher.js"></script>
</body>
</html>
